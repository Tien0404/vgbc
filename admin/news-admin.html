<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quản trị Tin tức</title>
  <link rel="stylesheet" href="../css/styles.css">
  <style>
    .admin-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    .admin-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }
    .admin-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 30px;
    }
    .admin-table th, .admin-table td {
      border: 1px solid #ddd;
      padding: 12px;
      text-align: left;
    }
    .admin-table th {
      background-color: #f2f2f2;
    }
    .admin-table tr:nth-child(even) {
      background-color: #f9f9f9;
    }
    .admin-actions {
      display: flex;
      gap: 10px;
    }
    .btn-edit, .btn-delete, .btn-toggle {
      padding: 6px 12px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }
    .btn-edit {
      background-color: #4CAF50;
      color: white;
    }
    .btn-delete {
      background-color: #f44336;
      color: white;
    }
    .btn-toggle {
      background-color: #2196F3;
      color: white;
    }
    .news-form {
      background-color: #f9f9f9;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 30px;
    }
    .form-group {
      margin-bottom: 15px;
    }
    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    .form-group input, .form-group select, .form-group textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    .hidden {
      display: none;
    }
    .status-active {
      color: green;
      font-weight: bold;
    }
    .status-inactive {
      color: red;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="admin-container">
    <div class="admin-header">
      <h1>Quản trị Tin tức</h1>
      <button id="addNewsBtn" class="btn btn--primary">Thêm tin tức mới</button>
    </div>

    <!-- Form thêm/sửa tin tức -->
    <div id="newsForm" class="news-form hidden">
      <h2 id="formTitle">Thêm tin tức mới</h2>
      <form id="newsDataForm">
        <input type="hidden" id="newsId">
        
        <div class="form-group">
          <label for="newsTitle">Tiêu đề</label>
          <input type="text" id="newsTitle" required>
        </div>
        
        <div class="form-group">
          <label for="newsCategory">Danh mục</label>
          <select id="newsCategory" required>
            <option value="ngon-ngu">Ngôn ngữ</option>
            <option value="su-kien">Sự kiện</option>
            <option value="dao-tao">Đào tạo</option>
            <option value="khac">Khác</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="newsContent">Nội dung</label>
          <textarea id="newsContent" rows="5" required></textarea>
        </div>
        
        <div class="form-group">
          <label for="newsImage">Hình ảnh (URL)</label>
          <input type="url" id="newsImage" placeholder="https://example.com/image.jpg">
        </div>
        
        <div class="form-group">
          <label for="newsAuthor">Tác giả</label>
          <input type="text" id="newsAuthor" required>
        </div>
        
        <div class="form-group">
          <label for="newsDate">Ngày đăng</label>
          <input type="date" id="newsDate" required>
        </div>
        
        <div class="admin-actions">
          <button type="submit" class="btn btn--primary">Lưu</button>
          <button type="button" id="cancelBtn" class="btn btn--ghost">Hủy</button>
        </div>
      </form>
    </div>

    <!-- Bảng hiển thị tin tức -->
    <table class="admin-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Tiêu đề</th>
          <th>Danh mục</th>
          <th>Tác giả</th>
          <th>Ngày đăng</th>
          <th>Trạng thái</th>
          <th>Hành động</th>
        </tr>
      </thead>
      <tbody id="newsTableBody">
        <!-- Dữ liệu tin tức sẽ được tải vào đây -->
      </tbody>
    </table>
  </div>

  <script>
    // Khởi tạo dữ liệu
    let newsData = [];
    let editingNewsId = null;

    // Hàm tải dữ liệu tin tức
    async function loadNewsData() {
      try {
        const response = await fetch('../data/news-data.json');
        const data = await response.json();
        newsData = data.news;
        renderNewsTable();
      } catch (error) {
        console.error('Lỗi khi tải dữ liệu tin tức:', error);
        alert('Không thể tải dữ liệu tin tức. Vui lòng thử lại sau.');
      }
    }

    // Hàm hiển thị dữ liệu trong bảng
    function renderNewsTable() {
      const tableBody = document.getElementById('newsTableBody');
      tableBody.innerHTML = '';

      newsData.forEach(news => {
        const row = document.createElement('tr');
        
        const statusClass = news.display ? 'status-active' : 'status-inactive';
        const statusText = news.display ? 'Hiển thị' : 'Ẩn';
        
        row.innerHTML = `
          <td>${news.id}</td>
          <td>${news.title}</td>
          <td>${news.categoryDisplay}</td>
          <td>${news.author}</td>
          <td>${news.date}</td>
          <td class="${statusClass}">${statusText}</td>
          <td class="admin-actions">
            <button class="btn-edit" onclick="editNews(${news.id})">Sửa</button>
            <button class="btn-toggle" onclick="toggleNewsStatus(${news.id})">${news.display ? 'Ẩn' : 'Hiện'}</button>
            <button class="btn-delete" onclick="deleteNews(${news.id})">Xóa</button>
          </td>
        `;
        
        tableBody.appendChild(row);
      });
    }

    // Hàm thêm/sửa tin tức
    document.getElementById('newsDataForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const newsId = document.getElementById('newsId').value;
      const newsData = {
        title: document.getElementById('newsTitle').value,
        category: document.getElementById('newsCategory').value,
        categoryDisplay: getCategoryDisplay(document.getElementById('newsCategory').value),
        content: document.getElementById('newsContent').value,
        image: document.getElementById('newsImage').value || 'https://example.com/default.jpg',
        author: document.getElementById('newsAuthor').value,
        date: document.getElementById('newsDate').value,
        display: true
      };
      
      if (newsId) {
        // Cập nhật tin tức hiện có
        await updateNews(parseInt(newsId), newsData);
      } else {
        // Thêm tin tức mới
        await addNews(newsData);
      }
      
      // Reset form và ẩn đi
      resetForm();
      document.getElementById('newsForm').classList.add('hidden');
      
      // Tải lại dữ liệu
      await loadNewsData();
    });

    // Hàm lấy tên hiển thị của danh mục
    function getCategoryDisplay(category) {
      const categories = {
        'ngon-ngu': 'Ngôn ngữ',
        'su-kien': 'Sự kiện',
        'dao-tao': 'Đào tạo',
        'khac': 'Khác'
      };
      return categories[category] || 'Khác';
    }

    // Hàm thêm tin tức mới
    async function addNews(news) {
      try {
        // Lấy dữ liệu hiện tại
        const response = await fetch('../data/news-data.json');
        const data = await response.json();
        
        // Tạo ID mới
        const newId = data.news.length > 0 ? Math.max(...data.news.map(n => n.id)) + 1 : 1;
        
        // Thêm tin tức mới
        data.news.push({
          id: newId,
          ...news
        });
        
        // Lưu lại dữ liệu
        await saveNewsData(data);
        
        alert('Thêm tin tức thành công!');
      } catch (error) {
        console.error('Lỗi khi thêm tin tức:', error);
        alert('Không thể thêm tin tức. Vui lòng thử lại sau.');
      }
    }

    // Hàm cập nhật tin tức
    async function updateNews(id, updatedNews) {
      try {
        // Lấy dữ liệu hiện tại
        const response = await fetch('../data/news-data.json');
        const data = await response.json();
        
        // Tìm và cập nhật tin tức
        const index = data.news.findIndex(news => news.id === id);
        if (index !== -1) {
          data.news[index] = { id, ...updatedNews };
          
          // Lưu lại dữ liệu
          await saveNewsData(data);
          
          alert('Cập nhật tin tức thành công!');
        } else {
          alert('Không tìm thấy tin tức để cập nhật.');
        }
      } catch (error) {
        console.error('Lỗi khi cập nhật tin tức:', error);
        alert('Không thể cập nhật tin tức. Vui lòng thử lại sau.');
      }
    }

    // Hàm xóa tin tức
    async function deleteNews(id) {
      if (!confirm('Bạn có chắc chắn muốn xóa tin tức này?')) {
        return;
      }
      
      try {
        // Lấy dữ liệu hiện tại
        const response = await fetch('../data/news-data.json');
        const data = await response.json();
        
        // Lọc bỏ tin tức cần xóa
        data.news = data.news.filter(news => news.id !== id);
        
        // Lưu lại dữ liệu
        await saveNewsData(data);
        
        alert('Xóa tin tức thành công!');
        
        // Tải lại dữ liệu
        await loadNewsData();
      } catch (error) {
        console.error('Lỗi khi xóa tin tức:', error);
        alert('Không thể xóa tin tức. Vui lòng thử lại sau.');
      }
    }

    // Hàm chuyển đổi trạng thái hiển thị/ẩn tin tức
    async function toggleNewsStatus(id) {
      try {
        // Lấy dữ liệu hiện tại
        const response = await fetch('../data/news-data.json');
        const data = await response.json();
        
        // Tìm và cập nhật trạng thái tin tức
        const index = data.news.findIndex(news => news.id === id);
        if (index !== -1) {
          data.news[index].display = !data.news[index].display;
          
          // Lưu lại dữ liệu
          await saveNewsData(data);
          
          // Tải lại dữ liệu
          await loadNewsData();
        }
      } catch (error) {
        console.error('Lỗi khi cập nhật trạng thái tin tức:', error);
        alert('Không thể cập nhật trạng thái tin tức. Vui lòng thử lại sau.');
      }
    }

    // Hàm sửa tin tức
    function editNews(id) {
      const news = newsData.find(n => n.id === id);
      if (news) {
        document.getElementById('newsId').value = news.id;
        document.getElementById('newsTitle').value = news.title;
        document.getElementById('newsCategory').value = news.category;
        document.getElementById('newsContent').value = news.content;
        document.getElementById('newsImage').value = news.image;
        document.getElementById('newsAuthor').value = news.author;
        document.getElementById('newsDate').value = news.date;
        
        document.getElementById('formTitle').textContent = 'Sửa tin tức';
        document.getElementById('newsForm').classList.remove('hidden');
        
        editingNewsId = id;
      }
    }

    // Hàm reset form
    function resetForm() {
      document.getElementById('newsDataForm').reset();
      document.getElementById('newsId').value = '';
      document.getElementById('formTitle').textContent = 'Thêm tin tức mới';
      editingNewsId = null;
    }

    // Hàm lưu dữ liệu tin tức
    async function saveNewsData(data) {
      // Trong môi trường thực tế, bạn cần một server-side script để ghi file
      // Ở đây chúng ta chỉ mô phỏng việc lưu dữ liệu
      console.log('Dữ liệu cần lưu:', JSON.stringify(data, null, 2));
      
      // Hiển thị thông báo cho người dùng
      alert('Trong môi trường thực tế, dữ liệu sẽ được lưu vào file. Hiện tại, dữ liệu chỉ được lưu trong bộ nhớ tạm thời.');
    }

    // Sự kiện khi nhấn nút "Thêm tin tức mới"
    document.getElementById('addNewsBtn').addEventListener('click', function() {
      resetForm();
      document.getElementById('newsForm').classList.remove('hidden');
    });

    // Sự kiện khi nhấn nút "Hủy"
    document.getElementById('cancelBtn').addEventListener('click', function() {
      resetForm();
      document.getElementById('newsForm').classList.add('hidden');
    });

    // Tải dữ liệu khi trang được tải
    document.addEventListener('DOMContentLoaded', loadNewsData);
  </script>
</body>
</html>